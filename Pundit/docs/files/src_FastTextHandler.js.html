<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;FastTextHandler.js - Pundit</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;thepund.it&#x2F;assets&#x2F;img&#x2F;pundit_500.png" title="Pundit"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: PUNDIT Project 0.12-Pumpkin</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsBase.html">pundit.annotators.AnnotatorsBase</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.AnnotatorsConductor.html">pundit.annotators.AnnotatorsConductor</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.FakeAnnotator.html">pundit.annotators.FakeAnnotator</a></li>
            
                <li><a href="..&#x2F;classes/pundit.annotators.TextFragmentAnnotator.html">pundit.annotators.TextFragmentAnnotator</a></li>
            
                <li><a href="..&#x2F;classes/pundit.authenticatedRequests.html">pundit.authenticatedRequests</a></li>
            
                <li><a href="..&#x2F;classes/pundit.baseComponent.html">pundit.baseComponent</a></li>
            
                <li><a href="..&#x2F;classes/pundit.BasePanel.html">pundit.BasePanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.CommentTag.html">pundit.CommentTag</a></li>
            
                <li><a href="..&#x2F;classes/pundit.CommentTagPanel.html">pundit.CommentTagPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Configuration.html">pundit.Configuration</a></li>
            
                <li><a href="..&#x2F;classes/pundit.contextualMenu.html">pundit.contextualMenu</a></li>
            
                <li><a href="..&#x2F;classes/pundit.DataTxt.html">pundit.DataTxt</a></li>
            
                <li><a href="..&#x2F;classes/pundit.DbpediaSpotlight.html">pundit.DbpediaSpotlight</a></li>
            
                <li><a href="..&#x2F;classes/pundit.FastTextHandler.html">pundit.FastTextHandler</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ImageAnnotationPanel.html">pundit.ImageAnnotationPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Init.html">pundit.Init</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ItemContainerManager.html">pundit.ItemContainerManager</a></li>
            
                <li><a href="..&#x2F;classes/pundit.KorboBasketSelector.html">pundit.KorboBasketSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.myPundit.html">pundit.myPundit</a></li>
            
                <li><a href="..&#x2F;classes/pundit.NotebookManager.html">pundit.NotebookManager</a></li>
            
                <li><a href="..&#x2F;classes/pundit.PageHandler.html">pundit.PageHandler</a></li>
            
                <li><a href="..&#x2F;classes/pundit.Previewer.html">pundit.Previewer</a></li>
            
                <li><a href="..&#x2F;classes/pundit.RecognizerPanel.html">pundit.RecognizerPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.ResourcesPanel.html">pundit.ResourcesPanel</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.BibServerSelector.html">pundit.selectors.BibServerSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.DBPediaSelector.html">pundit.selectors.DBPediaSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.EuropeanaSelector.html">pundit.selectors.EuropeanaSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.FreebaseSelector.html">pundit.selectors.FreebaseSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.SelectorBase.html">pundit.selectors.SelectorBase</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.VocabSelector.html">pundit.selectors.VocabSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.selectors.WordnetSelector.html">pundit.selectors.WordnetSelector</a></li>
            
                <li><a href="..&#x2F;classes/pundit.TripleComposer.html">pundit.TripleComposer</a></li>
            
                <li><a href="..&#x2F;classes/pundit.XpointersHelper.html">pundit.XpointersHelper</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/pundit.html">pundit</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;FastTextHandler.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * @class pundit.FastTextHandler
 * @extends pundit.BasePanel
 * @description ? TODO
 *&#x2F;
dojo.provide(&quot;pundit.FastTextHandler&quot;);
dojo.declare(&quot;pundit.FastTextHandler&quot;, pundit.BasePanel, {
    constructor:function(params){
        var self = this;

        self.initHTML();
        self.initContextMenu();
        self.initBehaviors();
        
        self._state = 0;
    },
    initHTML:function(){
        var self= this;
        self.log(&#x27;Init HTML FastTextHandler Panel&#x27;);

        var c =  &#x27;&#x27;;
        c += &#x27;&lt;div class=&quot;pundit-panel pundit-fth-container pundit-fth-state-0&quot;&gt;&#x27;;
        c += &#x27;  &lt;div class=&quot;pundit-fth-fragment pundit-fth-first&quot;&gt; 111 &lt;&#x2F;div&gt;&#x27;;
        c += &#x27;  &lt;span class=&quot;pundit-pane-title&quot;&gt; .. with .. &lt;&#x2F;span&gt;&#x27;;
        c += &#x27;  &lt;div class=&quot;pundit-fth-fragment pundit-fth-second&quot;&gt; 222 &lt;&#x2F;div&gt;&#x27;;
        
        c += &#x27;  &lt;div class=&quot;pundit-fth-status-message&quot;&gt;&#x27;;
        c += &#x27;    &lt;div class=&quot;pundit-fth-message-0&quot;&gt;Select another text fragment!&lt;&#x2F;div&gt;&#x27;;
        c += &#x27;  &lt;&#x2F;div&gt;&#x27;;

        c += &#x27;  &lt;div&gt;&#x27;;
        c += &#x27;    &lt;span class=&quot;pundit-gui-button&quot; id=&quot;pundit-fth-cancel-button&quot;&gt;&lt;span class=&quot;pundit-bicon pundit-remove-icon&quot;&gt;&lt;&#x2F;span&gt;&lt;span&gt;Cancel&lt;&#x2F;span&gt;&lt;&#x2F;span&gt;&#x27;;
        c += &#x27;    &lt;span class=&quot;pundit-gui-button&quot; id=&quot;pundit-fth-save-button&quot;&gt;&lt;span class=&quot;pundit-bicon pundit-save-icon&quot;&gt;&lt;&#x2F;span&gt; Go to save &lt;&#x2F;span&gt;&#x27;;
        c += &#x27;  &lt;&#x2F;div&gt;&#x27;;

        c += &#x27;&lt;&#x2F;div&gt;&#x27;;

        self.addHTMLContent(c);
    },
    initContextMenu:function(){
        var self = this;
        
        &#x2F;&#x2F; TODO: add 2+2 actions to use FTH on my and page items
        &#x2F;&#x2F; for steps 0 and 1
        
        cMenu.addAction({
            type: [&#x27;textSelectionHelper&#x27;],
            name: &#x27;connectText0&#x27;,
            label: &#x27;Connect this text to..&#x27;,
            showIf: function() {
                return self._state === 0;
            },
            onclick: function(item) {
                self.step(item.value);
                return true;
            }
        });

        cMenu.addAction({
            type: [&#x27;textSelectionHelper&#x27;],
            name: &#x27;connectText1&#x27;,
            label: &#x27;Connect to previously selected text&#x27;,
            showIf: function() {
                return self._state === 1;
            },
            onclick: function(item) {
                self.step(item.value);
                return true;
            }
        });


    },
    
    initBehaviors:function(){
        var self = this;
        
        dojo.connect(window, &quot;storage&quot;, function(e) {
            
            &#x2F;&#x2F; Skip all the local storage events, but the one on 
            &#x2F;&#x2F; the state variable
            if (e.key !== &quot;pundit-fth-state&quot;) {
                self.log(&#x27;Localstorage event on other key, discarding&#x27;);
                return false;
            }
            
            if (!(localStorage[&#x27;pundit-fth-state&#x27;])) {
                self.log(&#x27;ERROR: FTH state not defined?&#x27;);
                return false;
            }
                    
            var lsState = parseInt(localStorage[&#x27;pundit-fth-state&#x27;], 10),
                lsXP, lsText, lsItem;

            if (lsState === 0) {
                self.reset();
                self.log(&#x27;Step changed to 0? CLOSE ALL!&#x27;);
                
            } else if (lsState === 1) {

                if (!(localStorage[&#x27;pundit-fth-first-xp&#x27;] 
                    &amp;&amp; localStorage[&#x27;pundit-fth-first-text&#x27;] 
                    &amp;&amp; localStorage[&#x27;pundit-fth-first-item&#x27;])) {
                    self.log(&#x27;11: Something wrong, not everything is defined?!&#x27;);
                    return false;
                }
                
                lsXP = localStorage[&#x27;pundit-fth-first-xp&#x27;],
                lsText = localStorage[&#x27;pundit-fth-first-text&#x27;],
                lsItem = JSON.parse(localStorage[&#x27;pundit-fth-first-item&#x27;]);
                
                self._state = 0;
                self.step(lsXP, lsText, lsItem);
                
            } else if (lsState === 2) {

                if (!(localStorage[&#x27;pundit-fth-second-xp&#x27;] 
                    &amp;&amp; localStorage[&#x27;pundit-fth-second-text&#x27;] 
                    &amp;&amp; localStorage[&#x27;pundit-fth-second-item&#x27;])) {
                    self.log(&#x27;22: Something wrong, not everything is defined?!&#x27;);
                    return false;
                }
                
                lsXP = localStorage[&#x27;pundit-fth-second-xp&#x27;],
                lsText = localStorage[&#x27;pundit-fth-second-text&#x27;],
                lsItem = JSON.parse(localStorage[&#x27;pundit-fth-second-item&#x27;]);
                
                self._state = 1;
                self.step(lsXP, lsText, lsItem);
            }
        });
        
        dojo.connect(dojo.byId(&#x27;pundit-fth-cancel-button&#x27;), &quot;click&quot;, function() {
            self.log(&#x27;Cancel pressed: canceling panel&#x27;);
            self.reset();
            return false;
        });

        dojo.connect(dojo.byId(&#x27;pundit-fth-save-button&#x27;), &quot;click&quot;, function() {

            tripleComposer.addItemToSubject(self._first);
            tripleComposer.addItemToObject(self._second);

            semlibItems.addItem(self._first);
            previewer.buildPreviewForItem(self._first);
            semlibItems.addItem(self._second);
            previewer.buildPreviewForItem(self._second);
            
            if (!semlibWindow.isWindowOpen())
                semlibWindow.toggleWindow();
            
            &#x2F;&#x2F; TODO: the panel is positioned before the end of the animation, GASP
            setTimeout(function() { 
                tripleComposer.dndTargetsClickHandler(&#x27;&#x27;, dojo.query(&#x27;.pundit-tc-dnd.pre&#x27;)[0], &#x27;p&#x27;);
                self.reset();
            }, 550);
            
            return false;
        });
        
        
    }, &#x2F;&#x2F; initBehaviors()
    
    reset: function() {
        var self = this;
        
        self._state = 0;
        self._first = null;
        self._second = null;
        
        localStorage[&#x27;pundit-fth-state&#x27;] = 0;
        localStorage.removeItem(&#x27;pundit-fth-first-xp&#x27;);
        localStorage.removeItem(&#x27;pundit-fth-first-text&#x27;);
        localStorage.removeItem(&#x27;pundit-fth-first-item&#x27;);
        localStorage.removeItem(&#x27;pundit-fth-second-xp&#x27;);
        localStorage.removeItem(&#x27;pundit-fth-second-text&#x27;);
        localStorage.removeItem(&#x27;pundit-fth-second-item&#x27;);
        
        self.hide();
    },
    
    step: function(xp, text, item) {
        var self = this;
        
        &#x2F;&#x2F; If step() gets called with text and item, use them, otherwise
        &#x2F;&#x2F; extract them from the local DOM
        text = text || fragmentHandler.getLastSelectedContent();
        item = item || fragmentHandler.createItemFromXpointer(xp);
        
        switch (self._state) {
            case 0:

                localStorage[&#x27;pundit-fth-first-xp&#x27;] = xp;
                localStorage[&#x27;pundit-fth-first-text&#x27;] = text;
                localStorage[&#x27;pundit-fth-first-item&#x27;] = JSON.stringify(item);
                localStorage[&#x27;pundit-fth-state&#x27;] = 1;

                self._first = item;
                self._state = 1;

                dojo.query(&#x27;.pundit-fth-first&#x27;).innerHTML(text);
                dojo.query(&#x27;.pundit-fth-second&#x27;).innerHTML(&#x27;..&#x27;);
                dojo.query(&#x27;.pundit-fth-container&#x27;)
                    .removeClass(&#x27;pundit-fth-state-1 pundit-fth-state-2&#x27;)
                    .addClass(&#x27;pundit-fth-state-0&#x27;);

                self.show();
                
            break;
            
            case 1:

                localStorage[&#x27;pundit-fth-second-xp&#x27;] = xp;
                localStorage[&#x27;pundit-fth-second-text&#x27;] = text;
                localStorage[&#x27;pundit-fth-second-item&#x27;] = JSON.stringify(item);
                localStorage[&#x27;pundit-fth-state&#x27;] = 2;
                self._state = 2;
                self._second = item;

                dojo.query(&#x27;.pundit-fth-second&#x27;).innerHTML(text);
                dojo.query(&#x27;.pundit-fth-container&#x27;)
                    .removeClass(&#x27;pundit-fth-state-0&#x27;)
                    .addClass(&#x27;pundit-fth-state-1&#x27;);

                self.show();
            break;
            
            case 2:
                self.reset();
            break;
                
        }
        
    }
    

});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
